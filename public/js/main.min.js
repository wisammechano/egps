function addRow(t){var e=$("tbody.tbody").filter("#d"+t),i=e.find("tr:eq(0)"),t=e.find("tr").length+1,n="<tr>"+i.html()+"</tr>";e.append(n);var r=e.find("tr:last");r.find("td.n").find("span.del b").html(t),r.find("td").find("select.unit").html(""),$('input[type="tel"]').forceNumeric()}function delRow(t,e){var i=$("tbody.tbody").filter("#d"+e),n=i.find("tr");if(n.length>1&&confirm("Delete?"))for(n.eq(t).remove(),e=t;e<n.length;e++)n.eq(e).find("td.n").find("span.del b").html(e)}function addSub(t,e){{var i,n=$("table"),r=n.find("tbody.thead").filter("#d"+e),d=n.find("tbody.tbody").filter("#d"+e),s=n.find("tbody.tsep").filter("#d"+e),e=random(100,999);d.find("tr")}i='<tbody class="thead" id="d'+e+'">',i+=r.html(),i+="</tbody>",i+='<tbody class="tbody" id="d'+e+'">',t||(i+="<tr>",i+=d.find("tr:eq(0)").html(),i+="</tr>"),i+="</tbody>",i+='<tbody class="tsep" id="d'+e+'">',i+=s.html(),i+="</tbody>",s.after(i),t?d.find("tr").each(function(){var t=$(this).clone();t.appendTo("tbody.tbody#d"+e)}):$("tbody.tbody#d"+e).find("tr").each(function(){$(this).find("td").find("select.unit").html("")}),$('input[type="tel"]').forceNumeric()}function delSub(t){var e=$("tbody.thead, tbody.tbody, tbody.tsep");e.length>3&&confirm("Sure?")&&e.filter("#d"+t).each(function(){$(this).remove()})}function random(t,e){return Math.floor(Math.random()*(e-t+1)+t)}$(document).ready(function(){$("form.validate").validateInput(),$('input[type="tel"]').forceNumeric(),$('input[type="date"]').formatDate("dd/mm/yyyy"),$("body").on("click","#addRow",function(t){t.preventDefault();var e;e=$(this).parents("tbody.tsep").attr("id"),addRow(e.substr(1))}),$("body").on("click","#addSub",function(t){t.preventDefault();var e;e=$(this).parents("tbody.tsep").attr("id");var i=confirm("Clone ?");addSub(i,e.substr(1))}),$("body").on("click",".del",function(t){i=$(this).find("b").html()-1,j=$(this).parents("tbody.tbody").attr("id"),delRow(i,j.substr(1))}),$("body").on("click",".delS",function(t){i=$(this).parents("tbody.thead").attr("id"),delSub(i.substr(1))}),$("body").on("change","tr select.type",function(){var t=this.value,e=$(this).parents("tr").find("select.unit"),i=$(this).parents("tr").find("input.unit");"custom"==t?(e.css("display","none"),e.prop("name",""),i.prop("name","system['units'][]")):("none"===e.css("display")&&(e.css("display",""),e.prop("name","system['units'][]"),i.prop("name","")),e.html(""),url="?units="+t,e.load(url))})}),function(t){jQuery.fn.validateInput=function(){return this.each(function(){t(this).submit(function(e){var n=t(this).find("div.required input, select"),r=n.filter(function(){return""==this.value}),d=n.filter(function(){return""!=this.value});if(r.length>0)for(i=0;i<r.length;i++){var s=r.eq(i);s.parents("div.required").addClass("has-error").addClass("empty-field"),0===i?s.focus():{}}if(d.length>0)for(i=0;i<d.length;i++){var s=d.eq(i);s.parents("div.required").not("div.invalid").removeClass("has-error").removeClass("empty-field").addClass("has-success")}var l=t(this).find("div.has-error");l.length>0&&e.preventDefault()});var e=t(this).find("div.check input");e.blur(function(){var e=t(this).prop("name"),i=t(this).prop("value"),n="#"+t(this).prop("id"),r="./validate?"+e+"="+i;t.getJSON(r,function(e){var i=e.valid,r=i?!1:e.msg;i?(t(n).parents("div.check").addClass("has-success").addClass("valid").removeClass("empty-field").removeClass("has-error").removeClass("invalid"),t(n).next(".error").remove()):(t(n).parents("div.check").addClass("has-error").addClass("invalid").removeClass("empty-field").removeClass("has-success"),t(n).next(".error").length>0?(t(n).next(".error").remove(),t(n).after('<span class="error"><small>'+r+"</small></span>")):t(n).after('<span class="error"><small>'+r+"</small></span>"))})});var n=t("div.empty-field, input");n.keyup(function(){this.value.length>0&&t(this).parents("div.empty-field").not("div.invalid").removeClass("has-error").removeClass("empty-field")})})}}(jQuery),function(t){jQuery.fn.forceNumeric=function(){return this.each(function(){t(this).keydown(function(t){var e=t.which||t.keyCode;return!t.shiftKey&&!t.altKey&&!t.ctrlKey&&e>=48&&57>=e||e>=96&&105>=e||8==e||9==e||13==e||35==e||36==e||107==e||37==e||39==e||46==e||45==e?!0:!1})})}}(jQuery),function(t){t.fn.formatDate=function(e){function i(t){t=t?t:window.event;var e=t.which?t.which:t.keyCode;return 8==e||37==e||39==e||47==e||16==e?!0:!1}function n(t){t=t?t:window.event;var e=t.which?t.which:t.keyCode;return e>31&&(48>e||e>57)?!1:!0}function r(t){return void 0!=o[t]?o[t]:t}function d(t){return void 0!=a[t]?a[t]:t}function s(e){var i=e;if("/"===e.slice(e.length-1)){var n=e.split("/"),s=r(t.trim(n[0])),l=d(t.trim(n[1]));i=s+" / ",void 0!=l&&3==n.length&&(i+=l+" / ")}else if(e.length<2);else if(2==e.length)if(13>e)i=e+" / ";else{var a=r(e.slice(0,1)),o=d(e.slice(1));i=a+" / ",i+=o>0?o+" / ":o}else if(5==e.length);else if(10==e.length);else if(e.length>5&&e.length<10){var n=e.split("/"),s=n[0],l=n[1];i=t.trim(s)+" / ",i+=l>10||7==e.length?t.trim(l)+" / ":t.trim(l)}return i}function l(e){var i=e;if("/"===e.slice(e.length-1)){var n=e.split("/"),s=r(t.trim(n[0])),l=d(t.trim(n[1]));i=s+" / ",void 0!=l&&3==n.length&&(i+=l+" / ")}else if(e.length<2);else if(2==e.length)if(32>e)i=e+" / ";else{var a=r(e.slice(0,1)),o=d(e.slice(1));i=a+" / ",i+=o>0?o+" / ":o}else if(6==e.length){if(e.slice(5,6)>1){var o=d(e.slice(5,6));i=e.slice(0,5)+o+" / "}}else if(10==e.length);else if(e.length>5&&e.length<10){var n=e.split("/"),s=n[0],l=n[1];i=t.trim(s)+" / ",i+=l>10||7==e.length?t.trim(l)+" / ":t.trim(l)}return i}var a={1:"01",2:"02",3:"03",4:"04",5:"05",6:"06",7:"07",8:"08",9:"09",10:"10",11:"11",12:"12"},o={1:"01",2:"02",3:"03",4:"04",5:"05",6:"06",7:"07",8:"08",9:"09",10:"10",11:"11",12:"12",13:"13",14:"14",15:"15",16:"16",17:"17",18:"18",19:"19",20:"20",21:"21",22:"22",23:"23",24:"24",25:"25",26:"26",27:"27",28:"28",29:"29",30:"30",31:"31"},f=this;f.attr("maxlength","14"),f.keypress(function(t){return i(t)||n(t)}),f.keyup(function(t){return i(t)||""===f.val()?!1:void f.val("dd/mm/yyyy"===e?l(f.val()):s(f.val()))})}}(jQuery);